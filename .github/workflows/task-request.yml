name: Notify Discord on Assigned Issues or Task Requests

on:
  issues:
    types: [assigned, opened] # ì´ìŠˆê°€ í• ë‹¹ë˜ê±°ë‚˜ ìƒˆë¡œ ìƒì„±ë  ë•Œ ì‹¤í–‰

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Set Environment Variables
        run: |
          echo "ASSIGNEE=${{ github.event.issue.assignee.login }}" >> $GITHUB_ENV
          echo "ISSUE_URL=${{ github.event.issue.html_url }}" >> $GITHUB_ENV
          echo "ISSUE_TITLE=${{ github.event.issue.title }}" >> $GITHUB_ENV
          echo "WEBHOOK_URL=${{ secrets.DISCORD_WEBHOOK_URL }}" >> $GITHUB_ENV

      - name: Check Assignee or Title & Send Discord Notification
        run: |
          JSON_FILE=$(mktemp)
          TITLE_MATCH=false

          if [[ "$ISSUE_TITLE" =~ ^âœ…\ Task\ Request\ - ]]; then
            TITLE_MATCH=true
          fi

          if [[ "$TITLE_MATCH" == "true" ]]; then
            cat > $JSON_FILE <<EOF
            {
              "content": "ðŸ“¢ **ì´ìŠˆê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤!**\nðŸ‘¤ **ë‹´ë‹¹ìž:** $ASSIGNEE",
              "embeds": [
                {
                  "title": "ðŸ”— [GitHub ì´ìŠˆ ë§í¬]($ISSUE_URL)",
                  "description": "**ì´ìŠˆ ì œëª©:** $ISSUE_TITLE",
                  "color": 15258703,
                  "footer": {
                    "text": "GitHub Actions | Issue Alert"
                  },
                  "timestamp": "$(date -u +'%Y-%m-%dT%H:%M:%SZ')"
                }
              ]
            }
            EOF

            curl -X POST -H 'Content-type: application/json' --data @$JSON_FILE $WEBHOOK_URL
            rm $JSON_FILE
          fi
